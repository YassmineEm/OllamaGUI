<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Chat Lab | TP IA Locale avec WebSocket</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>">
    
    <style>
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-family: 'Inter', sans-serif;
        }
        
        .app-container {
            display: none; 
        }
    </style>
</head>
<body>

    <div class="app-container" id="appContainer">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">ðŸ¤–</div>
                    <h1>Ollama<span>Lab</span></h1>
                </div>
                <p class="subtitle">TP - Interface IA WebSocket</p>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-sliders-h"></i> Configuration</h3>
                <div class="model-select">
                    <label for="modelSelect">ModÃ¨le IA</label>
                    <select id="modelSelect" class="select-elegant">
                        <option value="llama3.2:3b">ðŸ¦™ Llama 3.2 3B</option>
                        <option value="mistral">ðŸŒ€ Mistral</option>
                        <option value="gemma">ðŸ’Ž Gemma</option>
                        <option value="llama2">ðŸ¦™ Llama 2</option>
                    </select>
                </div>

                <div class="mode-select">
                    <label>Mode de rÃ©ponse</label>
                    <div class="mode-options">
                        <button class="mode-option" data-mode="normal">
                            <i class="fas fa-paper-plane"></i>
                            <span>Standard</span>
                        </button>
                        <button class="mode-option active" data-mode="streaming">
                            <i class="fas fa-bolt"></i>
                            <span>Streaming</span>
                        </button>
                    </div>
                </div>

                <div class="temperature-control">
                    <label for="tempSlider">
                        <span>CrÃ©ativitÃ©</span>
                        <span id="tempValue">0.7</span>
                    </label>
                    <input type="range" id="tempSlider" min="0" max="1" step="0.1" value="0.7">
                    <div class="slider-labels">
                        <span>PrÃ©cis</span>
                        <span>Ã‰quilibrÃ©</span>
                        <span>CrÃ©atif</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-history"></i> Historique</h3>
                <div class="history-list" id="historyList">
                    <div class="empty-history">
                        <i class="far fa-comment-dots"></i>
                        <p>Chargement...</p>
                    </div>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <div class="status-dot" id="wsStatusDot"></div>
                    <span id="wsStatusText">Connexion...</span>
                </div>
                <button class="btn-new-chat" id="newChatBtn">
                    <i class="fas fa-plus"></i> Nouveau chat
                </button>
                <button class="btn-new-chat" id="clearHistoryBtn" style="margin-top: 10px; background: var(--danger);">
                    <i class="fas fa-trash"></i> Effacer historique
                </button>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="main-content">
            <!-- Chat Header -->
            <header class="chat-header">
                <div class="chat-info">
                    <h2 id="currentChatTitle">Conversation en cours</h2>
                    <div class="chat-meta">
                        <span class="model-badge" id="currentModelBadge">ðŸ¦™ Llama 3.2 3B</span>
                        <span class="date" id="currentDate">Aujourd'hui</span>
                        <span class="message-count" id="messageCount">0 messages</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" id="exportBtn" title="Exporter la conversation">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn-icon" id="refreshBtn" title="RafraÃ®chir">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </header>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Message -->
                <div class="welcome-message">
                    <div class="welcome-icon">âœ¨</div>
                    <h3>Bienvenue dans Ollama Lab WebSocket</h3>
                    <p>Connectez-vous Ã  un serveur WebSocket pour commencer Ã  discuter avec votre modÃ¨le IA local.</p>
                    
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-info">
                            <i class="fas fa-plug"></i>
                            <span>Ã‰tat: <strong id="connectionState">Non connectÃ©</strong></span>
                        </div>
                        <button id="reconnectBtn" class="btn-reconnect">
                            <i class="fas fa-redo"></i> Reconnecter
                        </button>
                    </div>
                    
                    <div class="quick-prompts">
                        <h4>Suggestions rapides :</h4>
                        <div class="prompt-grid">
                            <button class="prompt-btn" data-prompt="Explique le machine learning simplement">
                                <i class="fas fa-brain"></i>
                                Qu'est-ce que le ML ?
                            </button>
                            <button class="prompt-btn" data-prompt="Ã‰cris un poÃ¨me sur l'intelligence artificielle">
                                <i class="fas fa-pen-fancy"></i>
                                Ã‰cris un poÃ¨me
                            </button>
                            <button class="prompt-btn" data-prompt="RÃ©sume les concepts de base de Python">
                                <i class="fab fa-python"></i>
                                Python basics
                            </button>
                            <button class="prompt-btn" data-prompt="Quelle est la diffÃ©rence entre HTTP et HTTPS ?">
                                <i class="fas fa-globe"></i>
                                HTTP vs HTTPS
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        placeholder="Ã‰crivez votre message ici... (Shift + Enter pour nouvelle ligne, Enter pour envoyer)"
                        rows="2"
                        disabled
                    ></textarea>
                    
                    <div class="input-actions">
                        <button class="btn-attach" id="attachBtn" title="Attacher un fichier" disabled>
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button id="sendButton" class="btn-send" disabled>
                            <i class="fas fa-paper-plane"></i>
                            <span>Envoyer</span>
                        </button>
                    </div>
                </div>
                
                <div class="input-footer">
                    <div class="shortcuts">
                        <span class="shortcut">
                            <i class="fas fa-lightbulb"></i>
                            Mode: <strong id="currentModeText">Streaming</strong>
                        </span>
                        <span class="shortcut">
                            <i class="fas fa-key"></i>
                            Token: <code id="tokenDisplay">ollama-tp-2024</code>
                        </span>
                    </div>
                    <div class="character-count">
                        <span id="charCount">0</span>/2000
                    </div>
                </div>
            </div>
        </main>


        <footer class="status-bar">
            <div class="status-item">
                <i class="fas fa-server"></i>
                <span>WebSocket: <strong id="serverUrl">ws://localhost:3000</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-bolt"></i>
                <span>Ã‰tat: <strong id="connectionStatusText">Connexion...</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-user"></i>
                <span>Session: <strong id="sessionId">...</strong></span>
            </div>
        </footer>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">Initialisation de l'application...</p>
            <div class="loading-details">
                <p><small id="loadingDetail">Connexion au serveur WebSocket...</small></p>
            </div>
        </div>
    </div>


    <div id="notificationContainer"></div>

    <script src="script.js"></script>
</body>
</html>